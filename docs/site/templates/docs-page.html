{% extends "base.html" %}
{% macro render_docs_nav(section_path, current_permalink, nested=false) %}
    {% set docs_nav_section = get_section(path=section_path) %}
    {% if nested %}<h3 class="docs-nav-heading">{{ docs_nav_section.title }}</h3>{% endif %}
    {% if docs_nav_section.pages | length > 0 %}
        {% if nested %}
            <ul class="docs-nav-list docs-nav-list--nested">
            {% else %}
                <ul class="docs-nav-list">
                {% endif %}
                {% for docs_page in docs_nav_section.pages %}
                    <li>
                        <a class="docs-nav-link {% if docs_page.permalink == current_permalink %}is-active{% endif %}"
                           href="{{ docs_page.permalink }}">{{ docs_page.title }}</a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
        {% for subsection_path in docs_nav_section.subsections %}
            {{ self::render_docs_nav(section_path=subsection_path, current_permalink=current_permalink, nested=true) }}
        {% endfor %}
    {% endmacro render_docs_nav %}
    {% block title %}
        {{ page.title }} | {{ config.title }} Docs
    {% endblock title %}
    {% block canonical %}
        {{ page.permalink }}
    {% endblock canonical %}
    {% block page_width_class %}
        site-container-wide
    {% endblock page_width_class %}
    {% block main_width_class %}
        site-container-wide
    {% endblock main_width_class %}
    {% block main_extra_classes %}
        docs-layout
    {% endblock main_extra_classes %}
    {% block extra_scripts %}
        <script>
(function () {
  /**
   * Copy plain text to the clipboard and report whether it succeeded.
   *
   * This prefers the async Clipboard API and falls back to
   * `document.execCommand('copy')` for older browser support.
   */
  function copyTextToClipboard(text) {
    if (navigator.clipboard && window.isSecureContext) {
      return navigator.clipboard.writeText(text).then(function () { return true; }, function () { return false; });
    }

    var textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.setAttribute('readonly', '');
    textArea.style.position = 'absolute';
    textArea.style.left = '-9999px';
    document.body.appendChild(textArea);
    textArea.select();

    var copied = false;
    try {
      copied = document.execCommand('copy');
    } catch (error) {
      copied = false;
    }

    document.body.removeChild(textArea);

    return Promise.resolve(copied);
  }

  /** Attach a copy button to every fenced code block in `.docs-content`. */
  function attachCodeCopyButtons() {
    document.querySelectorAll('.docs-content pre').forEach(function (pre) {
      if (pre.querySelector('.docs-copy-btn')) {
        return;
      }

      var btn = document.createElement('button');
      btn.className = 'docs-copy-btn';
      btn.textContent = 'copy';
      btn.title = 'Copy to clipboard';
      btn.setAttribute('aria-label', 'Copy code');

      btn.addEventListener('click', function () {
        var code = pre.querySelector('code');
        var text = code ? code.innerText : pre.innerText;
        copyTextToClipboard(text).then(function (copied) {
          if (!copied) {
            return;
          }

          btn.textContent = 'copied!';
          setTimeout(function () { btn.textContent = 'copy'; }, 2000);
        });
      });

      pre.appendChild(btn);
    });
  }

  /**
   * Attach paragraph-level copyable links for explicit HTML anchors (`<a id="..."></a>`).
   *
   * The link is appended to the anchored paragraph so users can click `#`
   * to copy a deep link with the paragraph hash.
   */
  function attachParagraphAnchorLinks() {
    document.querySelectorAll('.docs-content a[id]:not([href]):not(.zola-anchor)').forEach(function (anchor) {
      var anchorId = anchor.getAttribute('id');
      var paragraph = anchor.nextElementSibling;

      if (!anchorId || !paragraph || paragraph.tagName !== 'P') {
        return;
      }

      if (paragraph.querySelector('.docs-paragraph-anchor-link')) {
        return;
      }

      var anchorLink = document.createElement('a');
      anchorLink.className = 'docs-paragraph-anchor-link';
      anchorLink.dataset.anchorId = anchorId;
      anchorLink.href = '#' + anchorId;
      anchorLink.textContent = '#';
      anchorLink.title = 'Copy link to this paragraph';
      anchorLink.setAttribute('aria-label', 'Copy link to this paragraph');

      anchorLink.addEventListener('click', function () {
        var paragraphUrl = new URL(window.location.href);
        paragraphUrl.hash = anchorId;

        copyTextToClipboard(paragraphUrl.toString()).then(function (copied) {
          if (!copied) {
            return;
          }

          anchorLink.textContent = 'copied!';
          setTimeout(function () { anchorLink.textContent = '#'; }, 2000);
        });
      });

      paragraph.classList.add('docs-paragraph-anchored');
      paragraph.appendChild(anchorLink);
    });
  }

  attachCodeCopyButtons();
  attachParagraphAnchorLinks();
})();
        </script>
    {% endblock extra_scripts %}
    {% block content %}
        <aside class="docs-sidebar">
            {{ self::render_docs_nav(section_path="docs/_index.md", current_permalink=page.permalink) }}
        </aside>
        <article class="docs-content-wrapper">
            <h1 class="docs-page-title">{{ page.title }}</h1>
            <div class="docs-content">{{ page.content | safe }}</div>
        </article>
    {% endblock content %}
